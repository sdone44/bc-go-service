package main

import (
	"encoding/hex"
	"fmt"
	"log"
	"os"

	"strings"

	"github.com/ethereum/go-ethereum/accounts/abi"
	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/common/hexutil"
	"github.com/joho/godotenv"
)

func main() {
	err := godotenv.Load()
	if err != nil {
		log.Fatal("Failed to load .env file:", err)
	}

	// 要解码的输入数据，这里使用一个随机的 16 进制字符串作为示例
	// input := "0x0c21ce9c000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd3dbbffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff889b0000000000000000000000000000000000000000000000000000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffce790fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdf25dffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff89020000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff80e6fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd2b89fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd45dcfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd76df0000000000000000000000000000000000000000000000000000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd3d7800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd889700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7d97ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8f5efffffffffffffffffffffffffffffffffffffffffffffffffffffffffffce213fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffccd4cfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd148e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd2bd4fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd1c90fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffda989fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd1745ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f860000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7cfbfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd2ae60000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff91cafffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd19cf0000000000000000000000000000000000000000000000000000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd670c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffcece0fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd323effffffffffffffffffffffffffffffffffffffffffffffffffffffffffff54b5fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe9d7bffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7a36ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff4c52ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8a7dfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffcb9d500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7ffa0000000000000000000000000000000000000000000000000000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdd5a0ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff88550000000000000000000000000000000000000000000000000000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd3caafffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd4d5efffffffffffffffffffffffffffffffffffffffffffffffffffffffffffcb378ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff2043ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7fc8fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd826300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc92ee0000000000000000000000000000000000000000000000000000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffcd7f0fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe074d0000000000000000000000000000000000000000000000000000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffcfc9a0000000000000000000000000000000000000000000000000000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd3ec100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd007fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8a30ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff845cfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed9850000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff83950000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7179000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd0c37ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff80630000000000000000000000000000000000000000000000000000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd5988ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8f55fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec1620000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff5f98ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9f38000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe8d8cfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd029f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffcd32dffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8870ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff5f8f0000000000000000000000000000000000000000000000000000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe226800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd0a3efffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd6d55fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd1624ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8750ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8044ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa15afffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd48e40000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa06dffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff854e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffcf82f0000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8618fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffda9ec00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff639f0000000000000000000000000000000000000000000000000000000000000000"
	input := "0x0c21ce9c0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000030f00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000023ba6ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff3afd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000287fc000000000000000000000000000000000000000000000000000000000001ca1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff46370000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff300000000000000000000000000000000000000000000000000000000000000263d6000000000000000000000000000000000000000000000000000000000002242700000000000000000000000000000000000000000000000000000000000223390000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002496200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001f89300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff17adffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff3b6400000000000000000000000000000000000000000000000000000000000290fd00000000000000000000000000000000000000000000000000000000000295dd0000000000000000000000000000000000000000000000000000000000026cb70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000251e400000000000000000000000000000000000000000000000000000000000263dc000000000000000000000000000000000000000000000000000000000001d48100000000000000000000000000000000000000000000000000000000000266e0ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1dad0000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0bcc0000000000000000000000000000000000000000000000000000000000023e260000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff5c490000000000000000000000000000000000000000000000000000000000026ded0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002112c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000029c3f0000000000000000000000000000000000000000000000000000000000023d86ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff43bbffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1c11ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff18adffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff30b0ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff3007000000000000000000000000000000000000000000000000000000000002c7ee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0dc60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001d517ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff346800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000023c850000000000000000000000000000000000000000000000000000000000022be0000000000000000000000000000000000000000000000000000000000002b8ceffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff263affffffffffffffffffffffffffffffffffffffffffffffffffffffffffff31a50000000000000000000000000000000000000000000000000000000000021e4100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002e61900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000028826000000000000000000000000000000000000000000000000000000000001b04d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000026e0f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000023e86000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000026c1effffffffffffffffffffffffffffffffffffffffffffffffffffffffffff38b9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff26c8ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff4e720000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff39010000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0e230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000027407ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff2a9d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000022af5ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff4d06000000000000000000000000000000000000000000000000000000000000fe280000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff24e8ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff61fd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff059d00000000000000000000000000000000000000000000000000000000000277aa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000290baffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff4d05ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffddd800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000018784000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000026dd800000000000000000000000000000000000000000000000000000000000216c10000000000000000000000000000000000000000000000000000000000026fa4ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff4c90ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff2d8affffffffffffffffffffffffffffffffffffffffffffffffffffffffffff6164000000000000000000000000000000000000000000000000000000000002546c0000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7787ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1ea0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002784f0000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff3c0f000000000000000000000000000000000000000000000000000000000001ed4300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff3e140000000000000000000000000000000000000000000000000000000000000000"
	output := "0x000000000000000000000000000000000000000000000000000000000000006500000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000063"
	// 解析 Solidity ABI，这里使用一个随机的 ABI 字符串作为示例
	abiStr := os.Getenv("CONTRACT_ABI")

	// 加载合约
	abi, err := abi.JSON(strings.NewReader(abiStr))
	if err != nil {
		log.Fatal(err)
	}
	// 获取合约方法id
	decodedSig, err := hex.DecodeString(input[2:10])
	if err != nil {
		log.Fatal(err)
	}
	// 加载合约方法
	method, err := abi.MethodById(decodedSig)
	if err != nil {
		log.Fatal(err)
	}

	// 解码input
	decodedData, err := hex.DecodeString(input[10:])
	if err != nil {
		log.Fatal(err)
	}
	re, err := method.Inputs.Unpack(decodedData)
	if err != nil {
		fmt.Printf("解码失败：%v\n", err)
		return
	}

	// 解码output
	decodedOutputData, err := hex.DecodeString(output[2:])
	if err != nil {
		log.Fatal(err)
	}
	re2, err := method.Outputs.Unpack(decodedOutputData)
	if err != nil {
		fmt.Printf("解码失败：%v\n", err)
		return
	}

	// 编码input
	// 准备参数
	to := "0x56c4a3e2b0677d01d28311e4e9fe5999665975c2"
	toAddress := common.HexToAddress(to)
	// encodeTo, err := hex.DecodeString(to[2:])
	if err != nil {
		log.Fatal(err)
	}

	// 将参数按照 ABI 格式编码为字节数组
	data, err := abi.Pack("balance", toAddress)
	if err != nil {
		panic(err)
	}

	// 将字节数组转换为十六进制字符串
	hexData := hexutil.Encode(data)
	fmt.Println(hexData)
	fmt.Printf("abi编码结果: %v\n", hexData)

	// 输出解码后的结果
	fmt.Printf("input解码结果: %v\n", re)

	fmt.Printf("input解码结果: %v\n", re2)

}
